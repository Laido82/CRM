<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contacts</title>
  <link href="/static/css/output.css" rel="stylesheet" />
  <link rel="icon" type="image/x-icon" href="/static/icons/contacts.png" />
  <script src="/static/htmx/htmx.js"></script>
</head>

<body class="bg-gray-900 min-h-screen py-8 px-4">
  <a href="/"
    class="fixed top-6 left-6 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl hover:scale-105 flex items-center gap-2">
    <img src="/static/icons/home.png" alt="Home" class="w-6 h-6" />
    Home
  </a>
  <div class="max-w-6xl mx-auto">
    <h1 class="text-4xl font-bold text-white text-center mb-8">
      System Contacts Management
    </h1>

    <!-- ✅ ADD CONTACT FORM -->
    <div class="bg-gray-800 rounded-lg shadow-xl p-6 mb-6 border border-gray-700">
      <form hx-post="/addContact" hx-indicator="#spinner-add" class="space-y-4" id="contact-form"
        hx-on::after-request="this.reset()">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <input type="text" name="firstName" placeholder="First Name" required
            class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-center text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
          <input type="text" name="lastName" placeholder="Last Name" required
            class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-center text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
          <input type="email" name="email" placeholder="Email" required
            class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-center text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
          <input type="number" name="age" min="18" max="120" placeholder="Age" required
            class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-center text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
        </div>

        <button type="button" hx-post="/addContact" hx-swap="innerHTML" hx-target="#result"
          hx-on::after-request="htmx.trigger('body', 'contactsUpdated')"
          class="w-full md:w-auto px-6 py-2 bg-green-600 text-white font-semibold text-center rounded-lg hover:bg-green-700 transition duration-200 mx-auto block shadow-lg">
          Add Contact
        </button>
        <div id="spinner-add" class="htmx-indicator text-blue-400 font-medium">
          Processing...
        </div>
      </form>
    </div>
    <div class="text-center text-gray-400 mb-4">
      <input hx-post="/searchedContacts" hx-trigger="keyup changed delay:500ms" type="text" name="searchTerm"
        hx-target="#list-contacts"
        class="text-gray-300 bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-center w-full md:w-1/2 lg:w-1/3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        placeholder="Search Contacts..." />
    </div>

    <!-- ✅ CONTACTS TABLE -->
    <div class="bg-gray-800 rounded-lg shadow-xl overflow-hidden border border-gray-700">
      <div id="list-contacts" hx-get="/listAllContactsUpdated" hx-trigger="contactsUpdated from:body"
        hx-swap="innerHTML">
        <div class="overflow-y-auto max-h-[700px]">
          <table class="min-w-full divide-y divide-gray-700">
            <thead class="bg-gray-900 sticky top-0">
              <tr>
                <th class="px-4 py-3 text-center text-lg font-medium text-gray-300 uppercase">
                  ID
                </th>
                <th class="px-4 py-3 text-center text-lg font-medium text-gray-300 uppercase">
                  First Name
                </th>
                <th class="px-4 py-3 text-center text-lg font-medium text-gray-300 uppercase">
                  Last Name
                </th>
                <th class="px-4 py-3 text-center text-lg font-medium text-gray-300 uppercase">
                  Email
                </th>
                <th class="px-4 py-3 text-center text-lg font-medium text-gray-300 uppercase">
                  Age
                </th>
                <th class="px-4 py-3 text-center text-lg font-medium text-gray-300 uppercase">
                  Actions
                </th>
              </tr>
            </thead>

            <tbody class="bg-gray-800 divide-y divide-gray-700">
              {{range .}}
              <tr class="hover:bg-gray-700 transition duration-150">
                <td class="px-6 py-3 text-center text-gray-300">{{.ID}}</td>
                <td class="px-6 py-3 text-center text-gray-300">
                  {{.FirstName}}
                </td>
                <td class="px-6 py-3 text-center text-gray-300">
                  {{.LastName}}
                </td>
                <td class="px-6 py-3 text-center text-gray-300">
                  {{.Email}}
                </td>
                <td class="px-6 py-3 text-center text-gray-300">{{.Age}}</td>
                <td class="px-6 py-3 text-center space-x-2">
                  <!-- 🔵 EDIT BUTTON -->
                  <button hx-post="/updateContact" hx-include="#contact-form" hx-vals='{"id":"{{.ID}}"}'
                    hx-confirm="⚠️ Are you sure you want to update {{.ID}} - {{.FirstName}} {{.LastName}}?"
                    hx-target="#result" hx-on::after-request="htmx.trigger('body', 'contactsUpdated')"
                    hx-swap-obb="true"
                    class="px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-200 shadow-md"
                    title="Fill in the fields above that you want to update, then click Edit">
                    Edit
                  </button>

                  <!-- 🔴 DELETE BUTTON -->
                  <button hx-post="/deleteContact" hx-swap="innerHTML" hx-target="#result"
                    hx-confirm="⚠️ Are you sure you want to delete {{.ID}} - {{.FirstName}} {{.LastName}}?"
                    hx-vals='{"id":"{{.ID}}"}' hx-on::after-request="htmx.trigger('body', 'contactsUpdated')"
                    hx-swap-obb="true"
                    class="px-3 py-1 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-200 shadow-md">
                    Delete
                  </button>
                </td>
              </tr>
              {{end}}
            </tbody>
          </table>
        </div>
      </div>
      <div id="result"></div>
    </div>
  </div>
</body>

</html>